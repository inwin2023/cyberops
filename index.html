<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberOps: Darknet Dominion — MVP</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #root { height: 100%; }
    body { margin: 0; background: #0b0b12; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const fmt = (n) => n.toLocaleString("en-US");
    const nowISO = () => new Date().toISOString();
    const KEYWORDS = ["ransom","zero-day","supply-chain","C2","phishing","APT","onion","darkmarket","drop site","broker","wallet","exploit","persistence","beacon","stealer","loader","initial access","MFA bypass","proxy","leak"];
    const POSTS = [
      "Rumors of a new zero-day spreading in unmanaged edge routers.",
      "Broker seeks access to midsize EU logistics firm, DM with onion.",
      "Phishing kit update adds MFA bypass techniques.",
      "Wallet tumbling service now supports faster mixing.",
      "Ransom group recruiting affiliates. Payouts weekly.",
      "Darkmarket vendor claims fresh DB dump of 2M emails.",
      "Forum mod warns about fake C2 frameworks loaded with stealers.",
      "Looking for loader devs. Need stable persistence on Win + AD.",
      "New beacon signature evades common EDR, ask for sample.",
      "Supply-chain hit discussed in private channel."
    ];
    const CONTRACT_TEMPLATES = [
      { title:"Corporate Breach Intel", brief:"Find indicators of a planned breach against a manufacturing client. Identify keyword, source, and confidence.", reward:[800,1400], heat:[6,12], type:"OSINT" },
      { title:"Silent Backdoor Hunt", brief:"Trace a C2 route (graph puzzle) and keep noise under threshold. Optimize path cost.", reward:[1200,2000], heat:[8,16], type:"ROUTING" },
      { title:"Password Vault Crack", brief:"Solve the cipher pattern (mini-CRACK) to unlock a protected archive.", reward:[600,1200], heat:[5,10], type:"CRACK" },
    ];
    const load = (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch(e){ return d; } };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    function OsintMini({ onSuccess, onFail }) {
      const [query, setQuery] = React.useState("");
      const [seed] = React.useState(() => rnd(0, 99999));
      const [targetKw] = React.useState(() => KEYWORDS[rnd(0, KEYWORDS.length - 1)]);
      const [data] = React.useState(() => {
        const rows = POSTS.map((p) => ({ text: p, kw: false }));
        const injectCount = rnd(2, 3);
        for (let i = 0; i < injectCount; i++) {
          const idx = rnd(0, rows.length - 1);
          if (!rows[idx].text.includes(targetKw)) {
            const words = rows[idx].text.split(" ");
            const pos = rnd(1, words.length);
            words.splice(pos, 0, targetKw);
            rows[idx] = { text: words.join(" "), kw: true };
          } else { rows[idx].kw = true; }
        }
        return rows;
      });
      const results = React.useMemo(() => {
        if (!query.trim()) return data;
        const q = query.toLowerCase();
        return data.filter((r) => r.text.toLowerCase().includes(q));
      }, [query, data, seed]);
      const found = data.filter((r) => r.text.includes(targetKw)).length;
      return (
        <div className="space-y-3">
          <div className="text-sm opacity-80">Target intel keyword is hidden in the noise. Hint: it exists {found}×.</div>
          <div className="flex gap-2">
            <input value={query} onChange={(e) => setQuery(e.target.value)} placeholder="Search posts (try keywords)…"
              className="w-full rounded-xl bg-zinc-900/60 border border-zinc-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500" />
            <button onClick={() => {
                if (query.trim().toLowerCase() === targetKw.toLowerCase()) onSuccess({ keyword: targetKw, matches: found });
                else onFail("Неверный ключ. Подумай о терминах на уровне SOC/Threat Intel.");
              }} className="px-3 py-2 rounded-xl bg-violet-600 hover:bg-violet-500">Confirm</button>
          </div>
          <div className="text-xs opacity-70">Tip: попробуй слова из мира угроз (APT, C2, zero-day, stealer…).</div>
          <div className="max-h-56 overflow-auto rounded-xl border border-zinc-700 divide-y divide-zinc-800">
            {results.map((r, i) => (<div key={i} className="p-3 text-sm">{r.text}</div>))}
          </div>
          <div className="text-xs opacity-60">Your guess must equal the hidden intel keyword exactly.</div>
        </div>
      );
    }
    function RoutingMini({ onSuccess, onFail }) {
      const [graph] = React.useState(() => {
        const nodes = ["SRC","A","B","C","DST"];
        const edges = [["SRC","A"],["SRC","B"],["A","C"],["B","C"],["C","DST"]].map(([u,v]) => ({ u, v, w: rnd(2,9), noise: rnd(1,5) }));
        return { nodes, edges };
      });
      const [budget] = React.useState(rnd(10, 16));
      const [noiseCap] = React.useState(rnd(6, 10));
      const [path, setPath] = React.useState(["SRC"]);
      const canExtend = (to) => {
        const last = path[path.length - 1];
        return graph.edges.some((e) => (e.u === last && e.v === to) || (e.v === last && e.u === to));
      };
      const cost = React.useMemo(() => {
        let total = 0, noise = 0;
        for (let i = 0; i < path.length - 1; i++) {
          const u = path[i]; const v = path[i+1];
          const e = graph.edges.find((e) => (e.u === u && e.v === v) || (e.v === u && e.u === v));
          if (e) { total += e.w; noise += e.noise; }
        }
        return { total, noise };
      }, [path, graph]);
      const complete = path[path.length - 1] === "DST";
      const ok = complete && cost.total <= budget && cost.noise <= noiseCap;
      return (
        <div className="space-y-3">
          <div className="text-sm opacity-80">Проложи маршрут от <b>SRC</b> к <b>DST</b> под бюджетом <b>{budget}</b> и шумом ≤ <b>{noiseCap}</b>.</div>
          <div className="grid grid-cols-5 gap-2">
            {graph.nodes.map((n) => (
              <button key={n} disabled={!canExtend(n) && !(n === "SRC" && path.length === 1)}
                onClick={() => { if (n === path[path.length - 1]) return; if (canExtend(n) || (n === "SRC" && path.length === 1)) setPath((p) => [...p, n]); }}
                className={`rounded-xl border px-3 py-2 text-sm ${
                  path.includes(n) ? "bg-emerald-700/40 border-emerald-500"
                  : (canExtend(n) || (n === "SRC" && path.length === 1)) ? "bg-zinc-900/50 border-zinc-700 hover:border-violet-500"
                  : "bg-zinc-900/20 border-zinc-800 opacity-50"
                }`}>{n}</button>
            ))}
          </div>
          <div className="text-xs">Path: {path.join(" → ")} | Cost: {cost.total} | Noise: {cost.noise}</div>
          {complete && (
            <div className="flex gap-2">
              <button onClick={() => (ok ? onSuccess({ path, cost }) : onFail("Маршрут превышает лимиты по бюджету/шуму."))}
                className="px-3 py-2 rounded-xl bg-violet-600 hover:bg-violet-500">Validate</button>
              <button onClick={() => setPath(["SRC"])} className="px-3 py-2 rounded-xl bg-zinc-800 border border-zinc-700">Reset</button>
            </div>
          )}
          <div className="rounded-xl border border-zinc-800 p-3 text-xs opacity-70">Подсказка: обычно SRC→A→C→DST или SRC→B→C→DST; сравни веса (cost) и шум (noise).</div>
        </div>
      );
    }
    function CrackMini({ onSuccess, onFail }) {
      const [seq] = React.useState(() => Array.from({ length: rnd(4, 6) }, () => rnd(1, 4)));
      const [input, setInput] = React.useState([]);
      const [show, setShow] = React.useState(false);
      const playBack = async () => {
        setShow(true);
        for (let i = 0; i < seq.length; i++) {
          const id = seq[i];
          const el = document.getElementById(`pad-${id}`);
          if (el) { el.classList.add("ring-4","ring-violet-500"); await new Promise((r) => setTimeout(r, 350)); el.classList.remove("ring-4","ring-violet-500"); }
          await new Promise((r) => setTimeout(r, 120));
        }
        setShow(false);
      };
      React.useEffect(() => { playBack(); }, []);
      React.useEffect(() => {
        if (input.length === seq.length) {
          const ok = input.every((v, i) => v === seq[i]);
          ok ? onSuccess({ length: seq.length }) : onFail("Неверная последовательность. Попробуй снова.");
          setInput([]);
        }
      }, [input, seq, onSuccess, onFail]);
      return (
        <div className="space-y-3">
          <div className="text-sm opacity-80">Повтори мигающую последовательность. Нажми «Play sequence» для подсказки.</div>
          <div className="grid grid-cols-2 gap-3 w-64">
            {[1,2,3,4].map((id) => (
              <button id={`pad-${id}`} key={id} disabled={show}
                onClick={() => setInput((p) => [...p, id])}
                className="h-20 rounded-2xl bg-zinc-900 border border-zinc-700 hover:border-violet-500">{id}</button>
            ))}
          </div>
          <button onClick={playBack} disabled={show} className="px-3 py-2 rounded-xl bg-violet-600 hover:bg-violet-500">Play sequence</button>
        </div>
      );
    }
    function newContract(day) {
      const t = CONTRACT_TEMPLATES[rnd(0, CONTRACT_TEMPLATES.length - 1)];
      return { id: `${day}-${Math.random().toString(36).slice(2,8)}`, title: t.title, brief: t.brief, type: t.type,
               reward: rnd(t.reward[0], t.reward[1]), heat: rnd(t.heat[0], t.heat[1]), createdAt: nowISO(), expiresIn: rnd(2,4) };
    }
    function Terminal({ onCommand }) {
      const [lines, setLines] = React.useState(["AGM> help for commands."]);
      const [cmd, setCmd] = React.useState("");
      const ref = React.useRef(null);
      const run = () => {
        const c = cmd.trim(); if (!c) return;
        const out = onCommand(c);
        setLines((L) => [...L, `AGM> ${c}`, ...(Array.isArray(out) ? out : [out])]);
        setCmd("");
      };
      React.useEffect(() => { ref.current?.scrollTo(0, ref.current.scrollHeight); }, [lines]);
      return (
        <div className="rounded-xl border border-zinc-700 bg-black/60">
          <div ref={ref} className="h-48 overflow-auto p-3 font-mono text-xs space-y-1">
            {lines.map((l, i) => (<div key={i} className="whitespace-pre-wrap">{l}</div>))}
          </div>
          <div className="flex border-t border-zinc-800">
            <input value={cmd} onChange={(e)=>setCmd(e.target.value)} onKeyDown={(e)=> e.key === "Enter" && run()}
              placeholder="help | scan | probe | status | next | accept <id> | decline <id>"
              className="w-full bg-black/70 px-3 py-2 text-sm focus:outline-none" />
            <button onClick={run} className="px-3 py-2 text-sm bg-zinc-900 hover:bg-zinc-800">Run</button>
          </div>
        </div>
      );
    }
    function App() {
      const [day, setDay] = React.useState(load("cyberops_day", 1));
      const [funds, setFunds] = React.useState(load("cyberops_funds", 2500));
      const [heat, setHeat] = React.useState(load("cyberops_heat", 5));
      const [rep, setRep] = React.useState(load("cyberops_rep", { corp: 5, state: 5, shadow: 5 }));
      const [contracts, setContracts] = React.useState(load("cyberops_contracts", [newContract(1), newContract(1), newContract(1)]));
      const [active, setActive] = React.useState(null);
      const [log, setLog] = React.useState(load("cyberops_log", []));
      const [toast, setToast] = React.useState(null);
      React.useEffect(() => { save("cyberops_day", day); }, [day]);
      React.useEffect(() => { save("cyberops_funds", funds); }, [funds]);
      React.useEffect(() => { save("cyberops_heat", heat); }, [heat]);
      React.useEffect(() => { save("cyberops_rep", rep); }, [rep]);
      React.useEffect(() => { save("cyberops_contracts", contracts); }, [contracts]);
      React.useEffect(() => { save("cyberops_log", log); }, [log]);
      const addLog = (text) => setLog((L) => [{ t: nowISO(), text }, ...L].slice(0, 100));
      const nextDay = () => {
        setDay((d) => d + 1);
        setHeat((h) => clamp(h - 1, 0, 100));
        setContracts((C) => {
          const left = C.map((c) => ({ ...c, expiresIn: c.expiresIn - 1 })).filter((c) => c.expiresIn > 0);
          while (left.length < 3) left.push(newContract(day + 1));
          return left;
        });
        addLog("День завершён. Поступили новые контракты и снизился шум.");
      };
      const accept = (id) => {
        const c = contracts.find((x) => x.id === id);
        if (!c) return false;
        setActive(c);
        setContracts((C) => C.filter((x) => x.id !== id));
        addLog(\`Контракт принят: \${c.title}\`);
        return true;
      };
      const decline = (id) => {
        const c = contracts.find((x) => x.id === id);
        if (!c) return false;
        setContracts((C) => C.filter((x) => x.id !== id));
        addLog(\`Контракт отклонён: \${c.title}\`);
        return true;
      };
      const completeMission = (success, details) => {
        if (!active) return;
        if (success) {
          setFunds((f) => f + active.reward);
          setHeat((h) => clamp(h + rnd(0, Math.max(1, active.heat - 3)), 0, 100));
          const delta = active.type === "OSINT" ? { corp: +1, state: +1, shadow: 0 }
                       : active.type === "ROUTING" ? { corp: 0, state: +1, shadow: +1 }
                       : { corp: +1, state: 0, shadow: +1 };
          setRep((r) => ({ corp: clamp(r.corp + delta.corp, 0, 100), state: clamp(r.state + delta.state, 0, 100), shadow: clamp(r.shadow + delta.shadow, 0, 100) }));
          addLog(\`Успех: \${active.title} (+$\${fmt(active.reward)}).\`);
          setToast({ kind: "ok", msg: \`Контракт выполнен: +$\${fmt(active.reward)}\` });
        } else {
          setHeat((h) => clamp(h + active.heat, 0, 100));
          setFunds((f) => Math.max(0, f - rnd(200, 400)));
          addLog(\`Провал: \${active.title}. Клиент недоволен.\`);
          setToast({ kind: "bad", msg: "Контракт провален. Рост шума и штраф." });
        }
        setActive(null);
      };
      const onCommand = (c) => {
        const [cmd, ...args] = c.split(/\s+/);
        switch (cmd) {
          case "help":
            return ["Commands:","help — подсказка","status — показатели","scan — сгенерировать разведданные (безопасно)","probe — рискованная разведка (меньше бюджета на миссию, но шум)","accept <id> — принять контракт","decline <id> — отклонить контракт","next — перейти к следующему дню"];
          case "status":
            return [\`Day \${day} | Funds $\${fmt(funds)} | Heat \${heat}/100\`,\`Reputation — Corp \${rep.corp}, State \${rep.state}, Shadow \${rep.shadow}\`,active ? \`Active: \${active.title}\` : "Active: none",\`Contracts: \${contracts.map((c) => c.id).join(", ")}\`];
          case "scan":
            setFunds((f) => f + 50); return ["Сканирование открытых источников… +$50 консультативного дохода."];
          case "probe":
            setFunds((f) => f + 120); setHeat((h) => clamp(h + 2, 0, 100)); return ["Активная разведка… +$120, +2 heat (следы в логах)."];
          case "accept":
            return [accept(args[0]) ? "Принято." : "Не найдено либо уже принято."];
          case "decline":
            return [ (decline(args[0]) ? "Отклонено." : "Не найдено."), "Совет: держи три слота для лучших предложений." ];
          case "next":
            nextDay(); return ["Переход к следующему дню…"];
          default:
            return ["Unknown command. type: help"];
        }
      };
      const MiniHost = () => {
        if (!active) return <div className="text-sm opacity-60">Прими контракт, чтобы начать мини-игру.</div>;
        const commonProps = { onSuccess: (details) => completeMission(true, details), onFail: (msg) => setToast({ kind: "bad", msg }) };
        if (active.type === "OSINT") return <OsintMini {...commonProps} />;
        if (active.type === "ROUTING") return <RoutingMini {...commonProps} />;
        if (active.type === "CRACK") return <CrackMini {...commonProps} />;
        return <div>Unknown contract type.</div>;
      };
      return (
        <div className="min-h-screen text-zinc-100 bg-gradient-to-br from-[#0b0b12] via-[#0f0f1a] to-[#111127]">
          <div className="max-w-6xl mx-auto p-4 md:p-8 space-y-6">
            <header className="flex items-center justify-between">
              <div><h1 className="text-2xl md:text-3xl font-semibold tracking-tight">CYBEROPS: DARKNET DOMINION</h1>
                <div className="text-xs opacity-70">AGM International Group • Browser MVP • v0.1</div></div>
              <div className="flex gap-2 text-sm">
                <div className="px-3 py-2 rounded-xl bg-zinc-900/70 border border-zinc-700">Day <b>{day}</b></div>
                <div className="px-3 py-2 rounded-xl bg-zinc-900/70 border border-zinc-700">Funds <b>${fmt(funds)}</b></div>
                <div className="px-3 py-2 rounded-xl bg-zinc-900/70 border border-zinc-700">Heat <b>{heat}</b></div>
              </div>
            </header>
            <section className="grid md:grid-cols-3 gap-4">
              <div className="md:col-span-2 space-y-4">
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40">
                  <div className="px-4 py-3 border-b border-zinc-800 flex items-center justify-between">
                    <h2 className="text-lg">Контракты</h2>
                    <button onClick={() => setContracts((C) => [...C, newContract(day)])}
                      className="text-sm px-3 py-2 rounded-xl bg-zinc-800 border border-zinc-700 hover:border-violet-500">Новый запрос</button>
                  </div>
                  <div className="divide-y divide-zinc-800">
                    {contracts.length === 0 && (<div className="p-4 text-sm opacity-60">Нет доступных контрактов. Используй <b>next</b> в терминале.</div>)}
                    {contracts.map((c) => (
                      <div key={c.id} className="p-4 flex items-start gap-3">
                        <div className="flex-1">
                          <div className="font-medium">{c.title}</div>
                          <div className="text-sm opacity-80">{c.brief}</div>
                          <div className="mt-2 text-xs opacity-70">Type: {c.type} • Reward ${fmt(c.reward)} • Heat {c.heat} • Expires in {c.expiresIn}d • ID: <span className="font-mono">{c.id}</span></div>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => accept(c.id)} className="px-3 py-2 rounded-xl bg-violet-600 hover:bg-violet-500 text-sm">Принять</button>
                          <button onClick={() => decline(c.id)} className="px-3 py-2 rounded-xl bg-zinc-800 border border-zinc-700 text-sm">Отклонить</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40">
                  <div className="px-4 py-3 border-b border-zinc-800 flex items-center justify-between">
                    <h2 className="text-lg">Операционная панель</h2>
                    {active && <div className="text-xs px-2 py-1 rounded-lg bg-emerald-800/30 border border-emerald-600">Active: {active.type}</div>}
                  </div>
                  <div className="p-4">
                    <MiniHost />
                    {active && (
                      <div className="mt-4 flex gap-2">
                        <button onClick={() => completeMission(false)} className="px-3 py-2 rounded-xl bg-red-700/70 border border-red-600 text-sm">Сдаться</button>
                        <button onClick={() => setActive(null)} className="px-3 py-2 rounded-xl bg-zinc-800 border border-zinc-700 text-sm">Пауза</button>
                      </div>
                    )}
                  </div>
                </div>
              </div>
              <div className="space-y-4">
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40">
                  <div className="px-4 py-3 border-b border-zinc-800"><h2 className="text-lg">Терминал</h2></div>
                  <div className="p-4"><Terminal onCommand={onCommand} /></div>
                </div>
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40">
                  <div className="px-4 py-3 border-b border-zinc-800"><h2 className="text-lg">Репутация</h2></div>
                  <div className="p-4 grid grid-cols-3 gap-2 text-sm">
                    {Object.entries(rep).map(([k, v]) => (
                      <div key={k} className="rounded-xl border border-zinc-700 bg-zinc-900/40 p-3">
                        <div className="uppercase text-xs opacity-70">{k}</div>
                        <div className="text-lg font-semibold">{v}</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40">
                  <div className="px-4 py-3 border-b border-zinc-800"><h2 className="text-lg">Лог событий</h2></div>
                  <div className="p-3 h-48 overflow-auto text-xs divide-y divide-zinc-800">
                    {log.length === 0 && <div className="p-2 opacity-60">Пока пусто.</div>}
                    {log.map((e, i) => (
                      <div key={i} className="p-2">
                        <div className="opacity-60">{new Date(e.t).toLocaleString()}</div>
                        <div>{e.text}</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="rounded-2xl border border-zinc-700 bg-zinc-950/40 p-3 text-xs opacity-70">
                  <div className="font-semibold mb-1">Советы</div>
                  <ul className="list-disc ml-5 space-y-1">
                    <li>Поддерживай Heat как можно ниже — иначе клиенты начнут избегать тебя.</li>
                    <li>Терминал: <span className="font-mono">scan</span> и <span className="font-mono">probe</span> помогут с деньгами.</li>
                    <li>Держи баланс репутаций Corp/State/Shadow — открываются разные типы контрактов.</li>
                  </ul>
                  <div className="mt-2 flex gap-2">
                    <button className="px-3 py-2 rounded-xl bg-zinc-800 border border-zinc-700"
                      onClick={() => { if (confirm("Сбросить прогресс?")) { localStorage.clear(); location.reload(); } }}>
                      Сброс прогресса
                    </button>
                  </div>
                </div>
              </div>
            </section>
            {toast && (
              <div className={`fixed bottom-6 right-6 px-4 py-3 rounded-xl border shadow-xl ${toast.kind === "ok" ? "bg-emerald-900/60 border-emerald-700" : "bg-red-900/60 border-red-700"}`}>
                <div className="text-sm">{toast.msg}</div>
                <button className="mt-1 text-xs opacity-70" onClick={() => setToast(null)}>Закрыть</button>
              </div>
            )}
            <footer className="text-xs opacity-60 text-center pt-4">
              © {new Date().getFullYear()} CyberOps MVP • Made for Evgenii // v0.1 — Single-file React (CDN)
            </footer>
          </div>
        </div>
      );
    }
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
